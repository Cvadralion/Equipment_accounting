@using Equipment_accounting.Models
@model EditEquipmentViewModel
@{
 ViewData["Title"] = "Редактирование оборудования";
}
<style>
 header {
  display: none;
 }

 body {
  justify-content: center;
 }

 footer {
  display: none;
 }
</style>
<h1 class="centered-title">Редактирование</h1>
<div class="edit-container">
 <button onclick="goBack()">Вернуться назад</button>
 <form asp-action="Edit" method="post" enctype="multipart/form-data">
  <div class="form-group">
   <p><b>Название:</b></p>
   <input asp-for="Name" class="form-control" />
   <span asp-validation-for="Name" class="text-danger"></span>
  </div>
  <div class="form-group">
   <p><b>Категория:</b></p>
   <select asp-for="CategoryId" class="form-control" asp-items="ViewBag.Categories"></select>
  </div>
  <div class="form-group" id="documentContainer">
   <p><b>Документ:</b></p>
   <input asp-for="Document" type="file" accept=".pdf" class="form-control" />
  </div>
  <div class="form-group">
   <p><b>Дата поступления:</b></p>
   <input type="date" asp-for="Receiptdate" class="form-control" />
   <span asp-validation-for="Receiptdate" class="text-danger"></span>
  </div>
  <div class="form-group">
   <p><b>Дата добавления/перемещения:</b></p>
   <input type="date" asp-for="Dateaddedormoved" class="form-control" />
   <span asp-validation-for="Dateaddedormoved" class="text-danger"></span>
  </div>
  <div class="form-group">
   <p for="Auditory"><b>Место нахождения:</b></p>
   <select asp-for="AuditoryId" class="form-control" asp-items="ViewBag.Auditory"></select>
  </div>
  <div class="form-group" id="qrCodeContainer">
   <p for="Auditory"><b>QR-код:</b></p>
   <img id="qrCode" src="qr_code_link" alt="QR Code" style="display: none">
   <button type="button" class="btn btn-primary" id="viewQRCode">Посмотреть</button>
  </div>
  <div class="form-group">
   <input id="imageUpload" type="file" accept=".png, .jpg, .jpeg" style="display:none" />
   <img id="imagePreview" src="default_image.jpg" alt="Image Preview" onclick="document.getElementById('imageUpload').click();" />
  </div>
  <div class="form-group" id="actionButtons">
   <input type="submit" value="Сохранить" class="btn btn-primary" />
   <form asp-action="Delete" method="post">
    <input type="hidden" asp-for="Id" />
    <input type="submit" value="Удалить" class="btn btn-danger" />
   </form>
  </div>
 </form>
</div>

<div id="qrCodeModal">
 <div id="qrCodeModalContent">
  <span id="closeModal">&times;</span>
  <img src="qr_code_link" alt="QR Code">
  <button id="copyQRCode" class="btn btn-primary">Скопировать</button>
 </div>
</div>

<script>
 function goBack() {
  window.history.back();
 }
 document.getElementById('viewQRCode').onclick = function () {
  document.getElementById('qrCodeModal').style.display = 'block';
 };

 document.getElementById('closeModal').onclick = function () {
  document.getElementById('qrCodeModal').style.display = 'none';
 };

 window.onclick = function (event) {
  if (event.target == document.getElementById('qrCodeModal')) {
   document.getElementById('qrCodeModal').style.display = 'none';
  }
 };

 document.getElementById('copyQRCode').onclick = function () {
  var img = document.querySelector('#qrCodeModalContent img');
  var canvas = document.createElement('canvas');
  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  var ctx = canvas.getContext('2d');
  ctx.drawImage(img, 0, 0);
  canvas.toBlob(function (blob) {
   var item = new ClipboardItem({ 'image/png': blob });
   navigator.clipboard.write([item]);
  });
 };

 document.getElementById('imageUpload').onchange = function (event) {
  var reader = new FileReader();
  reader.onload = function (e) {
   document.getElementById('imagePreview').src = e.target.result;
  }
  reader.readAsDataURL(event.target.files[0]);
 };

 document.querySelector('input[type="file"][asp-for="Document"]').onchange = function (event) {
  document.getElementById('documentName').textContent = event.target.files[0].name;
 };
</script>

<style>
 .edit-container {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  margin-top: 50px;
 }

 form {
  width: 100%;
  max-width: 600px;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 5px;
  background-color: #f9f9f9;
  margin-bottom: 20px;
 }

 .form-group {
  margin-bottom: 15px;
 }

 label {
  font-weight: bold;
 }

 .btn-primary {
  background-color: #007bff;
  border-color: #007bff;
 }

 .btn-danger {
  background-color: #dc3545;
  border-color: #dc3545;
 }

 #documentContainer {
  display: flex;
  align-items: center;
 }

  #documentContainer input[type="file"] {
   flex-grow: 1;
  }

 #documentName {
  margin-left: 10px;
  font-weight: bold;
 }

 #qrCodeContainer {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
 }

 #qrCode {
  margin-right: 10px;
  cursor: pointer;
  width: 100px;
  height: 100px;
  border: 1px solid #ddd;
 }

 #qrCodeModal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0,0,0);
  background-color: rgba(0,0,0,0.4);
 }

 #qrCodeModalContent {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 400px;
  text-align: center;
 }

 #qrCodeModal img {
  width: 100%;
  height: auto;
 }

 #actionButtons {
  display: flex;
  justify-content: space-between;
 }

 #imageUpload {
  cursor: pointer;
  width: 100px;
  height: 100px;
  border: 1px solid #ddd;
  background-color: #f1f1f1;
  display: flex;
  align-items: center;
  justify-content: center;
 }

 .input-container {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
 }

 .input-container {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 4px;
  background-color: #28a745;
  color: white;
  font-size: 16px;
  cursor: pointer;
 }

  .input-container input[type="submit"]:hover {
   background-color: #218838;
  }
</style>